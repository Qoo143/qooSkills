---
name: Code Review - Architecture Structure
description: 基於 OpenClaw 專案萃取的架構設計原則，審視程式碼結構並提供改進建議。包含 8 個審查維度的檢查清單與理想做法。
---

# Code Review - Architecture Structure

> 基於 OpenClaw 專案的架構設計原則審查框架

## 使用方式

```
請根據以下從 OpenClaw 專案萃取的架構設計原則，審視當前專案的程式碼結構，找出可以改進的地方。請逐項檢查並給出具體的改進建議與範例。
```

---

## 審查清單

### 1. 關注點分離（Separation of Concerns）

**檢查重點**：
- 每個檔案是否只負責一件事？是否有「上帝檔案」把路由、邏輯、驗證、資料存取全寫在一起？

**理想做法**：
- Controller（接收請求）→ Service（商業邏輯）→ DAO/Repository（資料存取）→ Schema/Types（型別定義），各自獨立檔案。

---

### 2. 依賴注入（Dependency Injection）

**檢查重點**：
- 模組之間是否透過參數傳入依賴，而非在內部直接 hard-code 呼叫？

**理想做法**：
- 由上層建立依賴物件後注入，而非讓底層模組自己去 new 或 import 具體實作。

---

### 3. 介面統一 / 策略模式（Interface Consistency）

**檢查重點**：
- 相似功能的模組（例如不同類型的資料處理器、不同頻道的處理器）是否共用統一的介面？

**理想做法**：
- 定義共用介面（如 ActionAdapter），所有實作都遵守同一契約，方便擴充新模組時不改既有程式碼。

---

### 4. 設定系統（Configuration）

**檢查重點**：
- 設定值是否散落在程式碼各處（magic number、hard-coded string）？

**理想做法**：
- 集中管理設定（config 檔 + schema 驗證 + 預設值），環境變數與設定檔分離，有型別保護。

---

### 5. 錯誤處理與驗證前置（Validation Early, Fail Fast）

**檢查重點**：
- 是否在流程最早的階段就驗證輸入？還是讓錯誤一路傳到深層才爆？

**理想做法**：
- 在 Controller/Middleware 層用 Schema 驗證輸入，通過後才進入 Service 層。

---

### 6. 測試友善性（Testability）

**檢查重點**：
- 函式是否可以單獨測試？還是因為緊耦合必須啟動整個系統才能測？

**理想做法**：
- 純函式優先、依賴可替換（mock）、測試檔與原始碼放在同目錄（colocated tests）。

---

### 7. 命名一致性（Naming Conventions）

**檢查重點**：
- 檔案、函式、變數命名是否有規律可循？

**理想做法**：
- 統一命名模式（如 `types.*.ts` 放型別、`*.test.ts` 放測試、`schema.*.ts` 放驗證）。

---

### 8. 模組擴充性（Extensibility）

**檢查重點**：
- 新增一個功能模組時，需要改幾個檔案？是否能做到「只加不改」？

**理想做法**：
- 插件/註冊表模式，新功能只需新增一個檔案並註冊，不動既有程式碼。

---

## 輸出格式要求

對每個項目，請回答：

1. **狀態評估**：✅ 已符合 / ⚠️ 部分符合 / ❌ 未符合
2. **目前狀態描述**（引用具體檔案與行號）
3. **改進建議**（附程式碼範例）
4. **優先級**：高/中/低

---

## 使用範例

### 基本用法
```
請檢查 @[專案目錄]，根據 code-review-structure skill 的 8 個維度進行審查
```

### 針對特定維度
```
請檢查 @[專案目錄] 的依賴注入實作
```

### 生成改進計畫
```
請根據審查結果，生成優先級排序的改進計畫
```
