---
name: systematic-debugging
description: "遇到任何 bug、測試失敗或意外行為時使用 - 在提出修復方案之前必須先找到根本原因"
---

# 系統性調試

## 概述

隨機修復浪費時間並產生新 bug。快速補丁只會掩蓋潛在問題。

**核心原則：** 在嘗試修復之前，必須先找到根本原因。症狀修復是失敗。

## 鐵律

```
沒有根本原因調查，就不能嘗試修復
```

如果你還沒完成第一階段，你不能提出修復方案。

## 適用場景

用於任何技術問題：
- 測試失敗
- 生產環境 bug
- 意外行為
- 性能問題
- 構建失敗
- 集成問題

## 四個階段

### 階段 1：根本原因調查

**在嘗試任何修復之前：**

1. **仔細閱讀錯誤信息**
   - 不要跳過錯誤或警告
   - 它們通常包含確切的解決方案
   - 完整閱讀堆棧跟踪
   - 記錄行號、文件路徑、錯誤代碼

2. **一致地重現**
   - 你能可靠地觸發它嗎？
   - 確切的步驟是什麼？
   - 每次都會發生嗎？

3. **檢查最近的變更**
   - 什麼變更可能導致這個問題？
   - Git diff，最近的提交
   - 新依賴，配置變更

4. **追蹤數據流**
   - 壞值從哪裡來？
   - 什麼調用了這個並傳入壞值？
   - 繼續向上追蹤直到找到源頭
   - 在源頭修復，而不是在症狀處

### 階段 2：模式分析

1. **找到工作的示例** - 在同一代碼庫中找類似的工作代碼
2. **與參考進行比較** - 完整閱讀參考實現
3. **識別差異** - 列出工作和損壞之間的每一個差異
4. **理解依賴** - 這需要什麼其他組件？

### 階段 3：假設和測試

1. **形成單一假設** - 明確陳述：「我認為 X 是根本原因，因為 Y」
2. **最小測試** - 做最小的可能變更來測試假設
3. **驗證後繼續** - 有效？→ 階段 4。無效？形成新假設

### 階段 4：實施

1. **創建失敗的測試用例** - 在修復前必須有
2. **實施單一修復** - 解決識別出的根本原因，一次一個變更
3. **驗證修復** - 測試通過？沒有其他測試損壞？
4. **如果 3+ 次修復失敗** - **停止並質疑架構**

## 危險信號 - 停下來遵循流程

如果你發現自己在想：
- 「先快速修復，之後再調查」
- 「試試改變 X 看看是否有效」
- 「添加多個變更，運行測試」
- 「好像是 X，讓我修復它」

**這些都意味著：停止。返回階段 1。**

## 常見藉口

| 藉口 | 現實 |
|------|------|
| 「問題很簡單，不需要流程」 | 簡單問題也有根本原因。流程對簡單 bug 很快。 |
| 「緊急情況，沒時間走流程」 | 系統性調試比猜測修復更快。 |
| 「先試這個，然後再調查」 | 第一次修復設定了模式。從一開始就做對。 |
| 「一次修復嘗試應該沒問題」(已試過 2+) | 3+ 次失敗 = 架構問題。質疑模式，不要再修復。 |
